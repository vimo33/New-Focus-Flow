# Focus Flow OS — Project Constitution

## Architecture

Focus Flow OS is a full-stack productivity system with three services:

- **Backend API** (Express + TypeScript) — port 3001, systemd: `focus-flow-backend`
- **Frontend UI** (React 19 + Vite + Tailwind) — port 5173, systemd: `focus-flow-frontend`
- **Telegram Bot** (grammy + TypeScript) — systemd: `focus-flow-telegram`

All services run as systemd units on this server. Manage with `systemctl restart focus-flow-*`.

## Vault Structure

The data layer is a file-based vault at `/srv/focus-flow/`:

```
00_inbox/raw/          → JSON files, one per captured item
00_inbox/archive/      → Processed inbox items
01_tasks/{work,personal,scheduled}/  → Task JSON files
02_projects/{active,paused,completed}/ → Project JSON files (also contains source code repos)
03_ideas/{inbox,validated,rejected}/   → Idea JSON files
04_notes/              → Markdown notes
05_events/             → Calendar events
06_health/logs/        → Health metrics (JSON + CSV)
07_system/             → System config, secrets, logs
```

## Key Source Locations

- Backend: `/srv/focus-flow/02_projects/active/focus-flow-backend/src/`
- Frontend: `/srv/focus-flow/02_projects/active/focus-flow-ui/src/`
- Telegram: `/srv/focus-flow/02_projects/active/focus-flow-telegram-bot/src/`

## Code Conventions

### Backend
- **VaultService** (`services/vault.service.ts`) — all vault CRUD goes through here
- **file-operations.ts** (`utils/file-operations.ts`) — low-level file I/O, `getVaultPath()` for path resolution
- **Routes** in `routes/*.routes.ts` — Express Router patterns
- IDs generated by `utils/id-generator.ts`
- TypeScript strict mode, CommonJS output

### Frontend
- React 19 with functional components and hooks
- Zustand for state management (`stores/`)
- Tailwind CSS for styling
- Vite for build tooling
- `VITE_API_URL` env var for API base URL (baked in at build time)
- API client singleton at `services/api.ts`

### Telegram Bot
- grammy framework
- Talks to backend API on localhost:3001
- Independent of OpenClaw/AI services

## Development Workflow

1. Edit source files
2. Build: `cd <service-dir> && npm run build`
3. Restart: `systemctl restart focus-flow-<service>`
4. Verify: `curl http://localhost:3001/health` (backend), `curl http://localhost:5173/` (frontend)

## Important Notes

- AI features (classification, idea validation) depend on OpenClaw gateway which is currently disabled. They will fail with a 5s timeout. This is expected.
- The vault path is hardcoded to `/srv/focus-flow` in `file-operations.ts`
- Frontend must be rebuilt (`npm run build`) for changes to take effect since it runs via `vite preview`
- The `02_projects/active/` directory contains both project JSON metadata files AND the actual source code repos (focus-flow-backend, focus-flow-ui, focus-flow-telegram-bot)
